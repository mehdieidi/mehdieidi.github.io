---
layout: default
---
{% assign year = page.started | date: '%Y' %}
{% assign tags = page.tags | join: '' %}
{% assign categories = page.categories | join: '' %}

{% if page._styles %}
  <!-- Page/Post style -->
  <style type="text/css">
    {{ page._styles }}
  </style>
{% endif %}

<div class="post">
  <header class="post-header">
    <h1 class="post-title" style="font-size: 1.8rem;">{{ page.title }}</h1>
    {% if page.author or page.released %}
      <p class="post-meta">
        {% if page.author %}
          {{ page.author }}
        {% endif %}
        {% if page.author and page.released %} &nbsp;&middot;&nbsp; {% endif %}
        {% if page.released %}
          {{ page.released }}
        {% endif %}
      </p>
    {% endif %}

    {% if page.started or page.finished or page.stars %}
      <p class="post-meta">
        {% if page.started %}
          <i class="fa-solid fa-play fa-sm" style="color: var(--global-tip-block) !important"></i> <em>{{ page.started }}</em>
        {% endif %}
        {% if page.finished %}
          {% if page.started %}
            &nbsp;&middot;&nbsp;
          {% endif %}
          <i class="fa-solid fa-stop fa-sm" style="color: #e56565 !important"></i> <em>{{ page.finished }}</em>
        {% endif %}
        {% if page.stars %}
          {% if page.started or page.finished %}
            &nbsp;&middot;&nbsp;
          {% endif %}
          {% if page.goodreads_review %}
            <a target="_blank" href="https://www.goodreads.com/review/show/{{ page.goodreads_review }}"><i class="fa-brands fa-goodreads-g"></i>
          {% endif %}
          {% assign full_stars = page.stars | floor %}
          {% assign half_star = page.stars | minus: full_stars %}
          {% assign empty_stars = 5 | minus: full_stars %}
          {% if half_star > 0 %}
            {% assign empty_stars = empty_stars | minus: 1 %}
          {% endif %}
          {% for i in (1..full_stars) -%}
            <i class="fa-solid fa-star fa-sm"></i>
          {%- endfor -%}
          {%- if half_star > 0 %}<i class="fa-solid fa-star-half-stroke fa-sm"></i>{% endif -%}
          {%- for i in (1..empty_stars) -%}
            <i class="fa-regular fa-star fa-sm"></i>
          {%- endfor -%}
          {% if page.goodreads_review %}
            </a>
          {% endif %}
        {% endif %}
        {% if page.buy_link %}
          {% if page.started or page.finished or page.stars %}
            &nbsp;&middot;&nbsp;
          {% endif %}
          <a target="_blank" href="{{ page.buy_link }}"
            ><i class="fa-solid fa-cart-shopping"></i>
            {% assign is_amazon_link = page.buy_link | slice: 0, 19 %}
            {% if is_amazon_link == 'https://www.amazon.' %}
              <i class="fa-brands fa-amazon"></i>
            {% endif %}
          </a>
        {% endif %}
      </p>
    {% endif %}
    <p class="post-tags">
      <a href="{{ year | prepend: '/books/' | relative_url }}"> <i class="fa-solid fa-calendar fa-sm"></i> {{ year }}</a>
      {% if tags != '' %}
        &nbsp;&middot;&nbsp;
        {% for tag in page.tags %}
          <a href="{{ tag | slugify | prepend: '/books/tag/' | relative_url }}"> <i class="fa-solid fa-hashtag fa-sm"></i> {{ tag }}</a>
          {% unless forloop.last %}
            &nbsp;
          {% endunless %}
        {% endfor %}
      {% endif %}

      {% if categories != '' %}
        &nbsp;&middot;&nbsp;
        {% for category in page.categories %}
          <a href="{{ category | slugify | prepend: '/books/category/' | relative_url }}"> <i class="fa-solid fa-tag fa-sm"></i> {{ category }}</a>
          {% unless forloop.last %}
            &nbsp;
          {% endunless %}
        {% endfor %}
      {% endif %}
    </p>
    <hr>
  </header>

  <div class="content-wrapper">
    <article class="main-content">
      {% if content == '' %}
        {% assign status = page.status | upcase %}
        <div class="clearfix">
          <h4>{{ status }}</h4>
        </div>
      {% else %}
        <h4>
          {% if page.start %} Start Date: {{ page.start | date: '%-d %B %Y' }}. {% endif %}
          {% if page.end %} End Date: {{ page.end | date: '%-d %B %Y' }}. {% endif %}
        </h4>
        {{ content }}
      {% endif %}
    </article>

    <aside class="sidebar">
      <figure>
        {% if page.cover %}
          <img alt="{{ page.title }} cover" src="{{ site.baseurl }}/{{ page.cover }}">
          <figcaption>
            Cover of <em>{{ page.title }}</em>
          </figcaption>
        {% elsif page.olid %}
          <img alt="{{ page.title }} cover" src="http://covers.openlibrary.org/b/olid/{{ page.olid }}-L.jpg?default=false">
          <figcaption>
            Cover of <em>{{ page.title }}</em> on the <a href="https://openlibrary.org/olid/{{ page.olid }}">Open Library</a>.
          </figcaption>
        {% elsif page.isbn %}
          <img alt="{{ page.title }} cover" src="http://covers.openlibrary.org/b/isbn/{{ page.isbn }}-L.jpg?default=false">
          <figcaption>
            Cover of <em>{{ page.title }}</em> on the <a href="https://openlibrary.org/isbn/{{ page.isbn }}">Open Library</a>.
          </figcaption>
        {% endif %}
      </figure>
    </aside>
  </div>

  <!-- Reading Streak Calendar Section -->
  {% if page.reading_log %}
  <div class="streak-section">
      <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">Reading Streak</h2>
      <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1.5rem;">My study sessions for "{{ page.title }}" over the last 5 months.</p>
      <div class="streak-container">
          <div id="streak-grid" class="streak-grid"></div>
      </div>
      <div class="streak-legend">
          <span>Less</span>
          <div class="day-legend level-0"></div>
          <div class="day-legend level-1"></div>
          <div class="day-legend level-2"></div>
          <div class="day-legend level-3"></div>
          <div class="day-legend level-4"></div>
          <span>More</span>
      </div>
  </div>
  {% endif %}
  <!-- End Reading Streak Calendar -->

  {% if site.giscus and page.giscus_comments %}
    {% include giscus.liquid %}
  {% endif %}
</div>

<style>
  /* --- Simplified Layout Styles --- */
  .content-wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
  }
  .main-content {
    flex: 2.5; /* Takes up more space */
    min-width: 300px; /* Prevents it from getting too small */
  }
  .sidebar {
    flex: 1; /* Takes up less space */
    min-width: 200px;
  }
  .sidebar figure {
    position: sticky;
    top: 2rem;
  }
  .sidebar img {
    width: 100%;
    border-radius: 8px;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  }
  .sidebar figcaption {
    text-align: center;
    font-size: 0.875rem;
    color: #6b7280;
    margin-top: 0.75rem;
  }

  /* --- Styles for Reading Streak Calendar --- */
  .streak-section {
    margin-top: 3rem;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  /* This media query makes the calendar smaller on desktop */
  @media (min-width: 768px) {
    .streak-container {
      max-width: 400px; 
    }
  }
  .streak-grid {
      display: grid;
      /* 22 columns for a ~5-month view */
      grid-template-columns: repeat(22, 1fr); 
      grid-template-rows: repeat(7, auto);
      grid-auto-flow: column;
      gap: 4px;
  }
  .day {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 3px;
      background-color: #ebedf0;
  }
  .day-legend {
      width: 12px;
      height: 12px;
      border-radius: 2px;
  }
  .level-0 { background-color: #ebedf0; }
  .level-1 { background-color: #9be9a8; }
  .level-2 { background-color: #40c463; }
  .level-3 { background-color: #30a14e; }
  .level-4 { background-color: #216e39; }
  .tooltip {
      visibility: hidden;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px 10px;
      position: absolute;
      z-index: 10;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      width: max-content;
  }
  .day-container:hover .tooltip { visibility: visible; opacity: 1; }
  .day-container { 
    position: relative; 
    display: inline-block; 
  }
  .streak-legend {
    display: flex;
    /* Changed from flex-end to flex-start to align left */
    justify-content: flex-start; 
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 0.5rem;
  }
</style>

{% if page.reading_log %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const streakGrid = document.getElementById('streak-grid');
    if (!streakGrid) return;

    const readingData = {{ page.reading_log | jsonify }};
    const dataMap = new Map(readingData.map(item => [item.date, item.level]));

    // تابع کمکی برای نرمال کردن تاریخ به نیمه‌شب
    function normalizeDate(date) {
        return new Date(date.getFullYear(), date.getMonth(), date.getDate());
    }

    const today = normalizeDate(new Date());

    // تاریخ شروع = ۵ ماه پیش
    const fiveMonthsAgo = normalizeDate(new Date());
    fiveMonthsAgo.setMonth(today.getMonth() - 5);

    // اولین روز = یکشنبه قبل از تاریخ شروع
    let currentDate = normalizeDate(new Date(fiveMonthsAgo));
    currentDate.setDate(currentDate.getDate() - currentDate.getDay());

    const fragment = document.createDocumentFragment();

    while (currentDate <= today) {
        const year = currentDate.getFullYear();
        const month = String(currentDate.getMonth() + 1).padStart(2, '0');
        const day = String(currentDate.getDate()).padStart(2, '0');
        const dateString = `${year}-${month}-${day}`;
        
        const dayContainer = document.createElement('div');
        dayContainer.classList.add('day-container');

        const level = dataMap.get(dateString) || 0;

        const daySquare = document.createElement('div');
        daySquare.classList.add('day', `level-${level}`);
        
        const tooltip = document.createElement('span');
        tooltip.classList.add('tooltip');
        const contributions = level > 0 ? `${level} session(s)` : 'No sessions';
        tooltip.textContent = `${contributions} on ${currentDate.toDateString()}`;

        dayContainer.appendChild(daySquare);
        dayContainer.appendChild(tooltip);
        
        fragment.appendChild(dayContainer);
        currentDate.setDate(currentDate.getDate() + 1);
    }

    streakGrid.appendChild(fragment);
});
</script>
{% endif %}
