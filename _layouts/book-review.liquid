---
layout: default
---
{% assign year = page.started | date: '%Y' %}
{% assign tags = page.tags | join: '' %}
{% assign categories = page.categories | join: '' %}

{% if page._styles %}
  <!-- Page/Post style -->
  <style type="text/css">
    {{ page._styles }}
  </style>
{% endif %}

<div class="post">
  <header class="post-header">
    <h1 class="post-title" style="font-size: 1.8rem;">{{ page.title }}</h1>
    {% if page.author or page.released %}
      <p class="post-meta">
        {% if page.author %}
          {{ page.author }}
        {% endif %}
        {% if page.author and page.released %} &nbsp;&middot;&nbsp; {% endif %}
        {% if page.released %}
          {{ page.released }}
        {% endif %}
      </p>
    {% endif %}

    {% if page.started or page.finished or page.stars %}
      <p class="post-meta">
        {% if page.started %}
          <i class="fa-solid fa-play fa-sm" style="color: var(--global-tip-block) !important"></i> <em>{{ page.started }}</em>
        {% endif %}
        {% if page.finished %}
          {% if page.started %}
            &nbsp;&middot;&nbsp;
          {% endif %}
          <i class="fa-solid fa-stop fa-sm" style="color: #e56565 !important"></i> <em>{{ page.finished }}</em>
        {% endif %}
        {% if page.stars %}
          {% if page.started or page.finished %}
            &nbsp;&middot;&nbsp;
          {% endif %}
          {% if page.goodreads_review %}
            <a target="_blank" href="https://www.goodreads.com/review/show/{{ page.goodreads_review }}"><i class="fa-brands fa-goodreads-g"></i>
          {% endif %}
          {% assign full_stars = page.stars | floor %}
          {% assign half_star = page.stars | minus: full_stars %}
          {% assign empty_stars = 5 | minus: full_stars %}
          {% if half_star > 0 %}
            {% assign empty_stars = empty_stars | minus: 1 %}
          {% endif %}
          {% for i in (1..full_stars) -%}
            <i class="fa-solid fa-star fa-sm"></i>
          {%- endfor -%}
          {%- if half_star > 0 %}<i class="fa-solid fa-star-half-stroke fa-sm"></i>{% endif -%}
          {%- for i in (1..empty_stars) -%}
            <i class="fa-regular fa-star fa-sm"></i>
          {%- endfor -%}
          {% if page.goodreads_review %}
            </a>
          {% endif %}
        {% endif %}
        {% if page.buy_link %}
          {% if page.started or page.finished or page.stars %}
            &nbsp;&middot;&nbsp;
          {% endif %}
          <a target="_blank" href="{{ page.buy_link }}"
            ><i class="fa-solid fa-cart-shopping"></i>
            {% assign is_amazon_link = page.buy_link | slice: 0, 19 %}
            {% if is_amazon_link == 'https://www.amazon.' %}
              <i class="fa-brands fa-amazon"></i>
            {% endif %}
          </a>
        {% endif %}
      </p>
    {% endif %}
    <p class="post-tags">
      <a href="{{ year | prepend: '/books/' | relative_url }}"> <i class="fa-solid fa-calendar fa-sm"></i> {{ year }}</a>
      {% if tags != '' %}
        &nbsp;&middot;&nbsp;
        {% for tag in page.tags %}
          <a href="{{ tag | slugify | prepend: '/books/tag/' | relative_url }}"> <i class="fa-solid fa-hashtag fa-sm"></i> {{ tag }}</a>
          {% unless forloop.last %}
            &nbsp;
          {% endunless %}
        {% endfor %}
      {% endif %}

      {% if categories != '' %}
        &nbsp;&middot;&nbsp;
        {% for category in page.categories %}
          <a href="{{ category | slugify | prepend: '/books/category/' | relative_url }}"> <i class="fa-solid fa-tag fa-sm"></i> {{ category }}</a>
          {% unless forloop.last %}
            &nbsp;
          {% endunless %}
        {% endfor %}
      {% endif %}
    </p>
    <hr>
  </header>

  <div class="content-wrapper">
    <article class="main-content">
      {% if content == '' %}
        {% assign status = page.status | upcase %}
        <div class="clearfix">
          <h4>{{ status }}</h4>
        </div>
      {% else %}
        <h4>
          {% if page.start %} Start Date: {{ page.start | date: '%-d %B %Y' }}. {% endif %}
          {% if page.end %} End Date: {{ page.end | date: '%-d %B %Y' }}. {% endif %}
        </h4>
        {{ content }}
      {% endif %}
    </article>

    <aside class="sidebar">
      <figure>
        {% if page.cover %}
          <img alt="{{ page.title }} cover" src="{{ site.baseurl }}/{{ page.cover }}">
          <figcaption>
            Cover of <em>{{ page.title }}</em>
          </figcaption>
        {% elsif page.olid %}
          <img alt="{{ page.title }} cover" src="http://covers.openlibrary.org/b/olid/{{ page.olid }}-L.jpg?default=false">
          <figcaption>
            Cover of <em>{{ page.title }}</em> on the <a href="https://openlibrary.org/olid/{{ page.olid }}">Open Library</a>.
          </figcaption>
        {% elsif page.isbn %}
          <img alt="{{ page.title }} cover" src="http://covers.openlibrary.org/b/isbn/{{ page.isbn }}-L.jpg?default=false">
          <figcaption>
            Cover of <em>{{ page.title }}</em> on the <a href="https://openlibrary.org/isbn/{{ page.isbn }}">Open Library</a>.
          </figcaption>
        {% endif %}
      </figure>
    </aside>
  </div>

  <!-- Reading Streak Calendar Section -->
  {% if page.reading_log %}
  <div class="streak-section">
      <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">Reading Streak</h2>
      <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1.5rem;">My study sessions for "{{ page.title }}" over the last 5 months.</p>
      <div class="streak-container">
          <div id="streak-grid" class="streak-grid"></div>
      </div>
      <div class="streak-legend">
          <span>Less</span>
          <div class="day-legend level-0"></div>
          <div class="day-legend level-1"></div>
          <div class="day-legend level-2"></div>
          <div class="day-legend level-3"></div>
          <div class="day-legend level-4"></div>
          <span>More</span>
      </div>
  </div>
  {% endif %}
  <!-- End Reading Streak Calendar -->

  {% if site.giscus and page.giscus_comments %}
    {% include giscus.liquid %}
  {% endif %}
</div>

<style>
/* --- Streak calendar (updated) --- */
.streak-container {
  max-width: 100%;
  overflow-x: auto; /* allow horizontal scroll if many weeks */
}
.streak-grid {
  display: grid;
  grid-auto-flow: column; /* fill by column (week) */
  gap: 4px;
  width: 100%;
  /* columns will be set dynamically by JS */
  grid-template-rows: repeat(7, 1fr);
}
.day-container { 
  position: relative; 
  display: inline-block; 
}
.day {
  width: 100%;
  aspect-ratio: 1 / 1;
  border-radius: 3px;
  background-color: #ebedf0;
  box-sizing: border-box;
}
.day-legend {
  width: 12px;
  height: 12px;
  border-radius: 2px;
}
.level-0 { background-color: #ebedf0; }
.level-1 { background-color: #9be9a8; }
.level-2 { background-color: #40c463; }
.level-3 { background-color: #30a14e; }
.level-4 { background-color: #216e39; }

.tooltip {
  visibility: hidden;
  background-color: #333;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 10px;
  position: absolute;
  z-index: 10;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  opacity: 0;
  transition: opacity 0.2s;
  pointer-events: none;
  width: max-content;
}
.day-container:hover .tooltip { visibility: visible; opacity: 1; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const streakGrid = document.getElementById('streak-grid');
  if (!streakGrid) return;

  // reading_log from Liquid -> JS array of {date: 'YYYY-MM-DD', level: N}
  const readingData = {{ page.reading_log | jsonify }};

  // map dateString -> level
  const dataMap = new Map();
  (readingData || []).forEach(item => {
    if (item && item.date) dataMap.set(item.date, item.level || 0);
  });

  // helpers
  function normalizeLocal(date) {
    return new Date(date.getFullYear(), date.getMonth(), date.getDate());
  }
  function fmt(date) {
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, '0');
    const d = String(date.getDate()).padStart(2, '0');
    return `${y}-${m}-${d}`;
  }

  const today = normalizeLocal(new Date());

  // start = same day-of-month, 5 months earlier (keeps day-of-month)
  const startCandidate = normalizeLocal(new Date(today.getFullYear(), today.getMonth() - 5, today.getDate()));

  // start on the closest past Sunday to align weeks (GitHub style)
  const startSunday = new Date(startCandidate);
  startSunday.setDate(startSunday.getDate() - startSunday.getDay());

  // number of days inclusive
  const MS_PER_DAY = 24 * 60 * 60 * 1000;
  const daysCount = Math.floor((today - startSunday) / MS_PER_DAY) + 1;
  const weeks = Math.ceil(daysCount / 7);

  // set grid columns dynamically
  streakGrid.style.gridTemplateColumns = `repeat(${weeks}, 1fr)`;

  const fragment = document.createDocumentFragment();
  const current = new Date(startSunday);

  while (current <= today) {
    const dateString = fmt(current);
    const level = dataMap.has(dateString) ? dataMap.get(dateString) : 0;

    const dayContainer = document.createElement('div');
    dayContainer.className = 'day-container';

    const daySquare = document.createElement('div');
    daySquare.className = `day level-${level}`;

    const tooltip = document.createElement('span');
    tooltip.className = 'tooltip';
    tooltip.textContent = (level > 0 ? `${level} session(s)` : 'No sessions') + ' on ' + current.toDateString();

    dayContainer.appendChild(daySquare);
    dayContainer.appendChild(tooltip);
    fragment.appendChild(dayContainer);

    // next day
    current.setDate(current.getDate() + 1);
  }

  streakGrid.appendChild(fragment);
});
</script>
{% endif %}
